<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì²­ì¶˜ë³µê¶Œ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <style>
    select, input {
      padding: 8px;
      width: 100%;
      margin: 8px 0 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-family: 'Pretendard', sans-serif;
      font-size: 14px;
      color: #333;
    }
    select {
      appearance: none;
      background-color: #fff;
      background-image: url("data:image/svg+xml,%3Csvg fill='gray' height='18' viewBox='0 0 24 24' width='18' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px 16px;
    }
    body {
      font-family: 'Pretendard', sans-serif;
      margin: 0;
      padding: 40px;
      background-color: #f4f6fc;
    }
    h1 {
      text-align: center;
      color: #d94f70;
    }
    .section {
      max-width: 800px;
      background: #fff;
      padding: 24px;
      margin: 20px auto;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    label {
      font-weight: 600;
    }
    button {
      background-color: #d94f70;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 8px;
    }
    button:hover {
      background-color: #be3a5a;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }
    .lotto-set {
      margin-bottom: 20px;
    }
    .number-inputs {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¯ ì²­ì¶˜ë³µê¶Œ ì¡°íšŒ</h1>

  <div class="section">
    <h2>1. ì „ì²´ ë²ˆí˜¸ í†µê³„</h2>
    <p id="totalCount" style="font-size: 0.9rem; color: #555; margin-bottom: 8px;"></p>
    <button onclick="loadStats()">í†µê³„ ìƒˆë¡œê³ ì¹¨</button>
    <table>
      <thead>
        <tr><th>ë²ˆí˜¸</th><th>ë°œê¸‰ íšŸìˆ˜</th></tr>
      </thead>
      <tbody id="statsBody"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>2. ë³µê¶Œ ë²ˆí˜¸ ì…ë ¥</h2>
    <button onclick="addLottoSet()">+ ë³µê¶Œ ë²ˆí˜¸ ì¶”ê°€</button>

    <div id="lottoContainer"></div>

    <label>í•™ê³¼ ì„ íƒ</label>
     <select id="department" required>
    <option value="">-- í•™ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
    <option>AIì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼</option>
    <option>ITê²½ì˜í•™ê³¼</option>
    <option>ê°„í˜¸í•™ê³¼</option>
    <option>ê±´ì„¤ì‹œìŠ¤í…œì•ˆì „ê³µí•™ê³¼</option>
    <option>ê±´ì¶•ì‚¬íšŒí™˜ê²½ê³µí•™ë¶€</option>
    <option>ê±´ì¶•í•™ë¶€</option>
    <option>ê²½ì˜í•™ê³¼</option>
    <option>êµ­ì–´êµ­ë¬¸í•™ê³¼</option>
    <option>êµ­ì œê²½ì œí†µìƒí•™ê³¼</option>
    <option>êµ­ì œê´€ê³„í•™ê³¼</option>
    <option>êµ­ì œë ˆì €ê´€ê´‘í•™ê³¼</option>
    <option>ê¸€ë¡œë²Œê²½ì˜í•™ê³¼</option>
    <option>ê¸€ë¡œë²Œê²½ì œí•™ê³¼</option>
    <option>ê¸€ë¡œë²Œê´€ê´‘í•™ê³¼</option>
    <option>ê¸€ë¡œë²Œê´€ê´‘í•™ë¶€</option>
    <option>ê¸€ë¡œë²Œì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼</option>
    <option>ê¸€ë¡œë²Œì¸ì¬í•™ë¶€</option>
    <option>ê¸€ë¡œë²Œììœ ì „ê³µí•™ë¶€</option>
    <option>ê¸€ë¡œë²Œí•œêµ­ì–´êµìœ¡í•™ê³¼</option>
    <option>ê¸€ë¡œë²Œí•œêµ­í•™ê³¼</option>
    <option>ê¸°ê³„ICTìœµí•©ê³µí•™ë¶€</option>
    <option>ê¸°ê³„ê³µí•™ê³¼</option>
    <option>ë””ìŠ¤í”Œë ˆì´ë°˜ë„ì²´ê³µí•™ê³¼</option>
    <option>ë””ìì¸í•™ë¶€</option>
    <option>ë””ì§€í„¸ì½˜í…ì¸ í•™ë¶€</option>
    <option>ë¬´ë„ê²½í˜¸í•™ê³¼</option>
    <option>ë¬´ë„ê²½í˜¸í•™ë¶€</option>
    <option>ë¬´ë„í•™ë¶€</option>
    <option>ë¬¼ë¦¬ì¹˜ë£Œí•™ê³¼</option>
    <option>ë¯¸ë””ì–´ì»¤ë®¤ë‹ˆì¼€ì´ì…˜í•™ê³¼</option>
    <option>ë¯¸ë””ì–´ì»¤ë®¤ë‹ˆì¼€ì´ì…˜í•™ë¶€</option>
    <option>ë¯¸ë˜ìë™ì°¨ê³µí•™ë¶€</option>
    <option>ë°˜ë„ì²´ì†Œì¬ê³µí•™ê³¼</option>
    <option>ë²•Â·ê²½ì°°í•™ê³¼</option>
    <option>ì‚¬í•™ê³¼</option>
    <option>ì‚¬íšŒë³µì§€í•™ê³¼</option>
    <option>ì‚°ì—…ê²½ì˜ê³µí•™ê³¼</option>
    <option>ì‚°ì—…ì•ˆì „ê²½ì˜ê³µí•™ê³¼</option>
    <option>ìƒë‹´Â·ì‚°ì—…ì‹¬ë¦¬í•™ê³¼</option>
    <option>ìƒë‹´ì‚°ì—…ì‹¬ë¦¬í•™ê³¼</option>
    <option>ìƒë‹´ì‹¬ë¦¬ì‚¬íšŒë³µì§€í•™ê³¼</option>
    <option>ìƒë‹´ì‹¬ë¦¬í•™ê³¼</option>
    <option>ì†Œë°©ë°©ì¬ì•ˆì „í•™ê³¼</option>
    <option>ìˆ˜ì‚°ìƒëª…ì˜í•™ê³¼</option>
    <option>ìŠ¤ë§ˆíŠ¸ìë™ì°¨ê³µí•™ë¶€</option>
    <option>ìŠ¤ë§ˆíŠ¸ì •ë³´í†µì‹ ê³µí•™ê³¼</option>
    <option>ìŠ¤í¬ì¸ ê³¼í•™ê³¼</option>
    <option>ìŠ¤í¬ì¸ ê³¼í•™ë¶€</option>
    <option>ì‹œê°ë””ìì¸í•™ê³¼</option>
    <option>ì‹í’ˆê³µí•™Â·ì˜ì–‘í•™ë¶€</option>
    <option>ì‹í’ˆê³¼í•™ë¶€</option>
    <option>ì‹ ì†Œì¬ê³µí•™ê³¼</option>
    <option>ì‹ í•™ê³¼</option>
    <option>ì‹ í•™ìˆœê²°í•™ê³¼</option>
    <option>ì—ë„ˆì§€í™”í•™ê³µí•™ê³¼</option>
    <option>ì—­ì‚¬Â·ì˜ìƒì½˜í…ì¸ í•™ë¶€</option>
    <option>ì—­ì‚¬ë¬¸í™”ì½˜í…ì¸ í•™ê³¼</option>
    <option>ì—­ì‚¬ë¬¸í™”ì½˜í…ì¸ í•™ë¶€</option>
    <option>ì˜ìƒì˜ˆìˆ í•™ê³¼</option>
    <option>ì˜í™”ì˜ìƒí•™ê³¼</option>
    <option>ì™¸êµ­ì–´ììœ¨ì „ê³µí•™ë¶€</option>
    <option>ì™¸êµ­ì–´í•™ë¶€</option>
    <option>ì‘ê¸‰êµ¬ì¡°í•™ê³¼</option>
    <option>ì¼ì–´ì¼ë³¸í•™ê³¼</option>
    <option>ììœ ì „ê³µí•™ë¶€</option>
    <option>ì „ìê³µí•™ê³¼</option>
    <option>ì •ë³´í†µì‹ ê³µí•™ê³¼</option>
    <option>ì •ì¹˜Â·êµ­ì œí•™ê³¼</option>
    <option>ì œì•½ìƒëª…ê³µí•™ê³¼</option>
    <option>ì œì•½í™”ì¥í’ˆí•™ê³¼</option>
    <option>ì¹˜ìœ„ìƒí•™ê³¼</option>
    <option>ì»´í“¨í„°ê³µí•™ë¶€</option>
    <option>í•œêµ­ë¬¸í•™ì½˜í…ì¸ ì°½ì‘í•™ê³¼</option>
    <option>í•­ê³µê´€ê´‘í•™ë¶€</option>
    <option>í–‰ì •Â·ê³µê¸°ì—…í•™ê³¼</option>
    <option>í–‰ì •í•™ê³¼</option>
    <option>í–‰ì •í•™ê³¼(ì•¼)</option>
    <option>í™˜ê²½ìƒëª…í™”í•™ê³µí•™ê³¼</option>
    <option>ê¸°íƒ€</option>
  </select>

    <label>í•™ë²ˆ ì…ë ¥</label>
    <input type="text" id="studentId" maxlength="10" placeholder="ì˜ˆ: 2020123456">
    <label>ì´ë¦„ ì…ë ¥</label>
    <input type="text" id="name" maxlength="20" placeholder="ì˜ˆ: í™ê¸¸ë™">

    <div>
      <button onclick="issueNumber()">ë°œê¸‰í•˜ê¸°</button>
    </div>
  </div>

  <script>
    let lottoCount = 0;
    const maxLottoCount = 2;

    function addLottoSet() {
      if (lottoCount >= maxLottoCount) {
        alert("ë³µê¶Œ ë²ˆí˜¸ëŠ” ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ë°œê¸‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        return;
      }

      const container = document.getElementById('lottoContainer');
      const div = document.createElement('div');
      div.className = 'lotto-set';
      div.innerHTML = `
        <label>ë³µê¶Œ ë²ˆí˜¸ ì„¸íŠ¸ ${lottoCount + 1}</label>
        <div class="number-inputs" id="set${lottoCount}">
          ${[0, 1, 2, 3, 4].map(i =>
            `<input type="text" maxlength="1" oninput="validateSet(${lottoCount})" />`
          ).join('')}
        </div>
        <p id="matchResult${lottoCount}" style="font-weight:bold;"></p>
      `;
      container.appendChild(div);
      lottoCount++;
    }

    function validateSet(index) {
      const inputs = document.querySelectorAll(`#set${index} input`);
      const values = Array.from(inputs).map(input => {
        input.value = input.value.replace(/[^0-9]/g, '');
        return input.value;
      });

      const duplicates = values.filter((v, i, arr) => v && arr.indexOf(v) !== i);
      inputs.forEach(input => {
        input.style.borderColor = duplicates.includes(input.value) ? 'red' : '#ccc';
      });

      const allValid = values.length === 5 && values.every(v => /^[0-9]$/.test(v)) && new Set(values).size === 5;
      if (!allValid) {
        document.getElementById(`matchResult${index}`).textContent = '';
        return;
      }

      fetch('/api/match', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ numbers: values })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById(`matchResult${index}`).textContent = `ê°™ì€ ë²ˆí˜¸ ë³´ìœ  ì¸ì›: ${data.count}ëª…`;
      });
    }

    function issueNumber() {
      const sets = [];
      for (let i = 0; i < lottoCount; i++) {
        const inputs = document.querySelectorAll(`#set${i} input`);
        const values = Array.from(inputs).map(input => input.value.trim());
        const allValid = values.length === 5 && values.every(v => /^[0-9]$/.test(v)) && new Set(values).size === 5;
        if (allValid) sets.push(values);
      }

      const department = document.getElementById('department').value.trim();
      const studentId = document.getElementById('studentId').value.trim();
      const name = document.getElementById('name').value.trim();

      if (!department || !studentId || !name) {
        alert('í•™ê³¼, í•™ë²ˆ, ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      if (sets.length === 0) {
        alert('ì ì–´ë„ í•˜ë‚˜ì˜ ë³µê¶Œ ë²ˆí˜¸ ì„¸íŠ¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }

      fetch('/api/issue', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ numbers: sets, department, studentId, name })
      })
      .then(async res => {
        if (!res.ok) {
          const err = await res.json();
          throw new Error(err.detail || 'ì˜¤ë¥˜ ë°œìƒ');
        }
        return res.json();
      })
      .then(data => {
        alert('ë³µê¶Œì´ ì„±ê³µì ìœ¼ë¡œ ë°œê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
        loadStats();
      })
      .catch(err => {
        alert(`ì˜¤ë¥˜: ${err.message}`);
        console.error(err);
      });
    }

    async function loadStats() {
      const res = await fetch('/api/stats');
      const data = await res.json();
      const tbody = document.getElementById('statsBody');
      tbody.innerHTML = '';
      let total = 0;
      data.stats.forEach(([combo, count]) => {
        if (combo.includes(' ')) {
          const formatted = combo.split(' ').join(' - ');
          tbody.innerHTML += `<tr><td>${formatted}</td><td>${count}</td></tr>`;
          total += count;
        }
      });
      document.getElementById('totalCount').textContent = `í˜„ì¬ê¹Œì§€ ë°œê¸‰ëœ ì²­ì¶˜ë³µê¶Œ ìˆ˜: ${total}ê±´`;
    }

    // ì´ˆê¸° ë³µê¶Œ í•œ ì„¸íŠ¸ ë Œë”ë§
    window.onload = () => {
      addLottoSet();
    }
  </script>
</body>
</html>
